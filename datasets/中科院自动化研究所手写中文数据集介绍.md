# CASIA 在线、离线中文手写数据库 - 林肯整理版

## 介绍
在线和离线中文手写数据库 CASIA-OLHWDB 和 CASIA-HWDB 由中国科学院自动化研究所模式识别国家重点实验室（NLPR）建设。 

手写样本由 1,020 名作家使用 Anoto 笔在纸上制作，从而获得在线和离线数据。 

样本包括孤立字符和手写文本（连续脚本）。 

我们从 2007 年到 2010 年收集了作家的数据，并于 2010 年完成了分割和标注。

数据库包括在线数据的六个数据集和离线数据的六个数据集，

每个数据集三个用于孤立字符（DB1.0-1.2）和 三个用于手写文本 (DB2.0–2.2)。 

在在线和离线情况下，孤立字符数据集包含约 390 万个样本，共 7,356 个类别（7,185 个汉字和 171 个符号），

手写文本数据集包含约 5,090 页和 135 万个字符样本。 所有数据都在字符级别进行了分割和注释，每个数据集都被划分为标准的训练和测试子集。

ICDAR 2011 上发布了对数据库的全面描述（[下载论文](http://www.nlpr.ia.ac.cn/databases/download/ICDAR2011-CASIA%20databases.pdf)）。

## 字符集

对于手写数据采集，我们根据标准字集 GB2312-80 和现代汉字常用字表（简称通用集）编制了一套字集。

GB2312-80 收录汉字 6763 个，其中一级字集 3755 个，二级字集 3008 个。

Common Set 包含 7,000 个汉字。 我们收集了两组的并集，包含 7,170 个字符，用于可能识别实际文档。 我们进一步添加了我们在体验中遇到的 15 个汉字。 

我们还收集了一组 171 个符号，包括 52 个英文字母、10 个数字，以及一些常用的标点符号、数学和物理符号。 因此，字符类的总数为 7,356。

为了收集手写文本，我们要求每位作者手抄五篇文本。 我们整理了三套文本（简称 V1-V3 版本），除 V1 和 V2 版本均有五篇中国古诗词文本外，大部分都是从新闻网页上下载的。 每组包含 50 个文本，每个包含 150-370 个字符。 这三套分别用于手写数据采集的不同阶段。 每组中的文本进一步分为 10 个子集（称为模板 T1-T10），每个子集包含由一位作者撰写的五篇文本。

## 数据采集

我们使用三组（版本）模板分三个阶段收集手写数据。 

每套有 10 个模板，由 10 位作者编写。 

一个模板有 13-15 页的独立字符和 5 页的文本。 

对于一个模板集，孤立的字符被分为三组：符号、高频汉字和低频汉字。

符号总是在第一页，后面是汉字。 

一组的前六个模板通过六等分旋转打印同一组高频汉字的六个不同顺序，后四个模板以四个不同的顺序打印低频汉字。 

轮换确保每个字符在不同的时间间隔内均匀书写，以获得平衡的书写质量。 此外，每个模板都有五页不同的文本。 

三套（版本）模板总结在表一中。

V1 和 V3 具有相同的隔离字符集。 V1 和 V3 的孤立汉字数实际上是 7184 个，而不是 7185 个，因为 V1 的模板设计最早。

V3 的模板继承了 V1 孤立的字符集，更新了文本。 

V1 和 V3 的常用汉字集实际上是 GB2312-80 的 level-1 集，通常作为汉字识别研究的标准集。


Version | Template           | \#pages    | \#symbols | \#Chinese | \#texts/chars    
------- |--------------------|------------| ------- | --------- | --------------------
V1      | T1-T6 <br/> T7-T10 | 20  <br/> 19 | 171 <br/> 171 | 3755 <br/> 3429 | 30/7,464 <br/> 20/4,918
V2      | T1-T6  <br/> T7-T10 | 20  <br/> 18 | 171  <br/> 171 | 3866  <br/> 3319 | 30/7,802 <br/> 20/5,196
V3      | T1-T6  <br/> T7-T10  | 20  <br/> 19 | 171  <br/> 171 | 3755  <br/> 3429 | 30/9,039 <br/> 20/6,016

## 数据分区

模板在（在线或离线）数据集 DB1.0-1.2 中的分布如表 V 所示，DB2.0-2.2 具有相同的分区。 

与孤立字符数据集相比，手写文本数据集 OLHWDB2.2 缺少模板 V2-T9 的训练编写器，HWDB2.0 缺少模板 V2-T3 的测试编写器。 

在所有数据库中，训练编写者和测试编写者的比例是 4:1。

<table class="waffle" cellspacing="0" cellpadding="0">
	<thead>
		<tr style="height: 20px">
			<td class="s0" dir="ltr">
				Dataset
			</td>
			<td class="s0" dir="ltr">
				Partition
			</td>
			<td class="s0" dir="ltr">
				Template
			</td>
			<td class="s0 softmerge" dir="ltr">
				<div class="softmerge-inner" style="width:97px;left:-1px">
					#writers per template
				</div>
			</td>
			<td class="s0" dir="ltr">
				total
			</td>
		</tr>
	</thead>
	<tbody>
		<tr style="height: 20px">
			<td class="s0" dir="ltr" rowspan="2">
				DB1.0
			</td>
			<td class="s0" dir="ltr">
				Train
			</td>
			<td class="s0" dir="ltr">
				V2 T1-T6
			</td>
			<td class="s0 softmerge" dir="ltr">
				<div class="softmerge-inner" style="width:97px;left:-1px">
					55:52:54:57:57:61
				</div>
			</td>
			<td class="s1" dir="ltr">
				336
			</td>
		</tr>
		<tr style="height: 20px">
			<td class="s0" dir="ltr">
				Test
			</td>
			<td class="s0" dir="ltr">
				V2 T1-T6
			</td>
			<td class="s0 softmerge" dir="ltr">
				<div class="softmerge-inner" style="width:97px;left:-1px">
					14:14:14:14:14:14
				</div>
			</td>
			<td class="s1" dir="ltr">
				84
			</td>
		</tr>
		<tr style="height: 20px">
			<td class="s0" dir="ltr" rowspan="4">
				DB1.1
			</td>
			<td class="s0" dir="ltr">
				Train
			</td>
			<td class="s0" dir="ltr">
				V1 T1-T6
			</td>
			<td class="s0" dir="ltr">
				9:8:8:10:9:9
			</td>
			<td class="s1" dir="ltr">
				53
			</td>
		</tr>
		<tr style="height: 20px">
			<td class="s0" dir="ltr">
				Train
			</td>
			<td class="s0" dir="ltr">
				V3 T1-T6
			</td>
			<td class="s0 softmerge" dir="ltr">
				<div class="softmerge-inner" style="width:97px;left:-1px">
					31:32:32:30:31:31
				</div>
			</td>
			<td class="s1" dir="ltr">
				187
			</td>
		</tr>
		<tr style="height: 20px">
			<td class="s0" dir="ltr">
				Test
			</td>
			<td class="s0" dir="ltr">
				V1 T1-T6
			</td>
			<td class="s0" dir="ltr">
				2:3:3:1:2:2
			</td>
			<td class="s1" dir="ltr">
				13
			</td>
		</tr>
		<tr style="height: 20px">
			<td class="s0" dir="ltr">
				Test
			</td>
			<td class="s0" dir="ltr">
				V3 T1-T6
			</td>
			<td class="s0" dir="ltr">
				8:7:7:9:8:8
			</td>
			<td class="s1" dir="ltr">
				47
			</td>
		</tr>
		<tr style="height: 20px">
			<td class="s0" dir="ltr" rowspan="2">
				DB1.2
			</td>
			<td class="s0" dir="ltr">
				Train
			</td>
			<td class="s0" dir="ltr">
				V2 T7-T10
			</td>
			<td class="s0" dir="ltr">
				60:60:60:60
			</td>
			<td class="s1" dir="ltr">
				240
			</td>
		</tr>
		<tr style="height: 20px">
			<td class="s0" dir="ltr">
				Test
			</td>
			<td class="s0" dir="ltr">
				V2 T7-T10
			</td>
			<td class="s0" dir="ltr">
				15:15:15:15
			</td>
			<td class="s1" dir="ltr">
				60
			</td>
		</tr>
	</tbody>
</table>

## 使用建议

1. 手写文档分割
2. 手写字符识别
3. 文本行识别
4. 手写文档检索
5. 编剧改编
6. 作家身份证明

## 在线数据库

![LnkFM9](https://oss.images.shujudaka.com/uPic/LnkFM9.jpg)

[关于 Anoto 笔的一个介绍](https://www.youtube.com/watch?v=N6skSKMYEao)

对于使用 Anoto 笔进行的手写数据收集，所有模板页面都打印在带有点图案的纸上。 

在打印的模板页面上，每个单独的字符都写在预印字符下方的空间中，每个文本都写在一个单独的页面上，模板文本打印在页面的上部。 

在书写过程中，在线数据（笔划轨迹：（x，y）坐标序列）由 Anoto 笔记录，然后传输到计算机。

### (a) 孤立的字符样本

![r1GspW](https://oss.images.shujudaka.com/uPic/r1GspW.jpg)

### (b) 手写文本样本

![YRyaYK](https://oss.images.shujudaka.com/uPic/YRyaYK.jpg)

### CASIA-OLHWDB1.0-1.2

在线数据库中有三个孤立字符的数据集。 

这些数据集的统计数据如表 1 所示。数据集包括 1020 个文件，每个文件（*.pot）存储一个人写的字符样本。 
*.pot 的文件格式在表 2 中指定。

表 1 在线孤立字符数据集统计

| Dataset   | #writers | #character samples | #character samples | #character samples |
|-----------|----------|--------------------|--------------------|--------------------|
|           |          |       total        |       Symbol       |   Chinese/#class   |
| OLHWDB1.0 | 420      |     1,694,741      |       71,806       |  1,622,935/3,866   |
| OLHWDB1.1 | 300      |     1,174,364      |       51,232       |  1,123,132/3,755   |
| OLHWDB1.2 | 300      |     1,042,912      |       51,181       |   991,731/3,319    |
| Total     | 1,020    |     3,912,017      |      174,219       |  3,737,798/7,185   |

OLHWDB1.0 包括 3866 个汉字和 171 个字母数字和符号。 3866 个汉字中，GB2312-80 一级字集 3740 个（共 3755 个字）。
OLHWDB1.1 包括 3755 个 GB2312-80 一级汉字和 171 个字母数字和符号。
OLHWDB1.2 包括 3319 个汉字和 171 个字母数字和符号。 OLHWDB1.2 中的汉字集（3,319 个类）是 OLHWDB1.0 中的一个不相交集。
OLHWDB1.0 和 OLHWDB1.2 共收录了 7185 个汉字（7185=3866+3319），收录了 GB2312 的全部 6763 个汉字。

表 2 在线孤立字符数据文件格式 (*.pot)

|                                     Item                                      |                                     Type                                      |                                    Length                                     |                                   Instance                                    |                                    Comment                                    |
|-------------------------------------------------------------------------------|-------------------------------------------------------------------------------|-------------------------------------------------------------------------------|-------------------------------------------------------------------------------|-------------------------------------------------------------------------------|
|                                  Sample size                                  |                                unsigned short                                 |                                      2B                                       |                                                                               |          Number of bytes for one sample (byte count to next sample)           |
|                                 Tag code (GB)                                 |                                     DWORD                                     |                                      4B                                       |                      "啊"=0x0000b0a1 Stored as 0xa1b00000                      |                 Only two bytes (GB2132 or GBK) are meaningful                 |
|                                 Stroke number                                 |                                unsigned short                                 |                                      2B                                       |                                                                               |                         Number of strokes in a sample                         |
| Strokes (concatenated). Each stroke is a point sequence from pen-down to lift | Strokes (concatenated). Each stroke is a point sequence from pen-down to lift | Strokes (concatenated). Each stroke is a point sequence from pen-down to lift | Strokes (concatenated). Each stroke is a point sequence from pen-down to lift | Strokes (concatenated). Each stroke is a point sequence from pen-down to lift |
|                       Coordinates (x, y) (concatenated)                       |                                     short                                     |                                     2B+2B                                     |                                                                               |                          All values less than 32768                           |
|                              Stroke end (-1, 0)                               |                                 signed short                                  |                                     2B+2B                                     |                                                                               |                                                                               |
|                               Character end tag                               |                               Character end tag                               |                               Character end tag                               |                               Character end tag                               |                               Character end tag                               |
|                             Character end (-1,-1)                             |                                 signed short                                  |                                     2B+2B                                     |                                                                               |                                                                               |

这里给出三个示例文件（[下载文件](http://www.nlpr.ia.ac.cn/databases/download/IsolatedSamples.rar)），每个数据集一个文件，您可以使用我们开发的这个软件（[下载软件](http://www.nlpr.ia.ac.cn/databases/download/POTView.exe)）查看它们。

CASIA-OLHWDB1.0-1.2 的完整数据集可在 [此处](http://www.nlpr.ia.ac.cn/databases/handwriting/Download.html) 下载。

### CASIA-OLHWDB2.0-2.2

在线手写文本数据集是由孤立字符数据集的同一作者制作的。 

每个人写五页给定的文本。 由于数据丢失，一位作家（671 号）和三页（2 页 328 号和 1 号 685 号）丢失了。 

每个页面都存储在以作者索引和页码命名的 `*.wptt` 文件中。 

除了页面的笔划轨迹数据外，数据文件还包括文本行分割的 ground-truths 和字符类标签（GB 代码中的文本行转录本）。 

数据集的统计数据和 `*.wptt` 文件的格式分别如表 3 和表 4 所示。

表 3 在线手写文本数据集统计

|  Dataset  | #writers | #pages | #lines | #character/#class | #out-of-class sample |
|-----------|----------|--------|--------|-------------------|----------------------|
| OLHWDB2.0 |   420    | 2,098  | 20,573 |   540,009/1,214   |        1,282         |
| OLHWDB2.1 |   300    | 1,500  | 17,282 |   429,083/2,256   |         255          |
| OLHWDB2.2 |   299    | 1,494  | 14,365 |   379,812/1,303   |         581          |
|   Total   |  1,019   | 5,092  | 52,220 |  1,348,904/2,655  |        2,088         |

类外样本是 7,356 个类（OLHWDB1.0-1.2 中的所有类）中的样本。

表 4. 在线文本文件格式 (*.wptt)

|               Item                |          Type          |         Length         |                                        Instance                                         |
|-----------------------------------|------------------------|------------------------|-----------------------------------------------------------------------------------------|
|            File Header            |      File Header       |      File Header       |                                       File Header                                       |
|          Size of Header           |        long int        |           4B           | Number of bytes: 54 + strlen (illustr) + 1 (there is a '\0' at the end of illustration) |
|            Format code            |     ASCII (char*)      |           8B           |                                         “WPTT”                                          |
|           Illustration            |          Text          |       Arbitrary        |                                       “#......\0”                                       |
|             Code type             |     ASCII (char*)      |          20B           |                                          “GB”                                           |
|            Code length            |       short int        |           2B           |                                            2                                            |
|             Data type             |     ASCII (char*)      |          20B           |                                         “short”                                         |
|           Sample length           |          int           |           4B           |                                                                                         |
|            Page index             |          int           |           4B           |                           Corresponding to that in trajectory                           |
|           Stroke number           |          int           |           4B           |                                                                                         |
|      Strokes (concatenated)       | Strokes (concatenated) | Strokes (concatenated) |                                 Strokes (concatenated)                                  |
|           Point number            |         short          |           2B           |                                                                                         |
|       Points (concatenated)       | Points (concatenated)  | Points (concatenated)  |                                  Points (concatenated)                                  |
| Coordinates (x, y) (concatenated) |     unsigned short     |         2B+2B          |              no PEN_DOWN and PEN_UP, all coordinates are multiplied by 10.              |
|            Line number            |     unsigned short     |           2B           |                                                                                         |
|       Lines (concatenated)        |  Lines (concatenated)  |  Lines (concatenated)  |                                  Lines (concatenated)                                   |
|        Line stroke number         |     unsigned short     |           2B           |                                                                                         |
| Line stroke index (concatenated)  |     unsigned short     |     2B*lineStrkNum     |                                                                                         |
|         Line char number          |     unsigned short     |           2B           |                                                                                         |
|       Chars (concatenated)        |  Chars (concatenated)  |  Chars (concatenated)  |                                  Chars (concatenated)                                   |
|             Tag code              |       Code type        | codelength*lineCharNum |              If the Tag code equal to 0xffff, it is an abnormal character.              |

$$
Sample Lenth=
4+4+4+strkNum*[2+strkPtNum*4]+2+lineNum*[2+2*lineStrkNum+2+lineCharNum*codeLength].
$$

使用我们开发的这款软件（[下载软件](http://www.nlpr.ia.ac.cn/databases/Download/WPTTView.exe)）可以查看 WPTT 手写页面。 [WPTTRead.cpp.pdf](http://www.nlpr.ia.ac.cn/databases/Download/WPTTRead.cpp.pdf) 中给出了从 *wptt 文件读取数据的示例 C++ 代码。
CASIA-OLHWDB2.0-2.2 的完整数据集可在 [此处](http://www.nlpr.ia.ac.cn/databases/handwriting/Download.html) 下载。

## 离线数据库

对于离线数据收集，扫描手写页面（分辨率为 300DPT）以获得彩色图像，使用注释工具对其进行分割和标记。 注释后，数据库图像的背景像素标记为 255，前景像素标记为 255 灰度级 (0-254)。 因此，只需将前景像素更改为 1，将背景像素更改为 0 即可获得二值图像。

### (a) 孤立的字符样本

![W2xhK9](https://oss.images.shujudaka.com/uPic/W2xhK9.jpg)

### (b) 手写文本样本

![GPmaf0](https://oss.images.shujudaka.com/uPic/GPmaf0.jpg)

### CASIA-HWDB1.0-1.2

离线手写数据库中有三个孤立字符的数据集。 这些数据集的统计数据如表 1 所示。数据集包括 1,020 个文件，每个文件（*.gnt）存储一个作者的拼接灰度字符图像。 *.gnt 的文件格式在表 2 中指定。

表 1 离线孤立字符数据集统计

| Dataset | #writers | #character samples | #character samples | #character samples |
|---------|----------|--------------------|--------------------|--------------------|
|         |          |       total        |       Symbol       |   Chinese/#class   |
| HWDB1.0 |   420    |     1,680,258      |       71,122       |  1,609,136/3,866   |
| HWDB1.1 |   300    |     1,172,907      |       51,158       |  1,121,749/3,755   |
| HWDB1.2 |   300    |     1,041,970      |       50,981       |   990,989/3,319    |
|  Total  |  1,020   |     3,895,135      |      173,261       |  3,721,874/7,185   |

HWDB1.0 包括 3866 个汉字和 171 个字母数字和符号。 3866 个汉字中，GB2312-80 一级字集 3740 个（共 3755 个字）。
HWDB1.1 包括 3755 个 GB2312-80 一级汉字和 171 个字母数字和符号。
HWDB1.2 包括 3319 个汉字和 171 个字母数字和符号。 HWDB1.2 中的汉字集（3,319 个类）是 HWDB1.0 中的一个不相交集。
HWDB1.0 和 HWDB1.2 共收录了 7185 个汉字（7185=3866+3319），收录了 GB2312 的全部 6763 个汉字。

表 2. 离线隔离字符数据文件格式 (*.gnt)

|     Item      |      Type      |       Length       |          Instance           |                          Comment                           |
|---------------|----------------|--------------------|-----------------------------|------------------------------------------------------------|
|  Sample size  |  unsigned int  |         4B         |                             | Number of bytes for one sample (byte count to next sample) |
| Tag code (GB) |      char      |         2B         | "啊"=0xb0a1 Stored as 0xa1b0 |                                                            |
|     Width     | unsigned short |         2B         |                             |                 Number of pixels in a row                  |
|    Height     | unsigned short |         2B         |                             |                       Number of rows                       |
|    Bitmap     | unsigned char  | Width*Height bytes |                             |                     Stored row by row                      |

这里给出三个示例文件（[下载文件](http://www.nlpr.ia.ac.cn/databases/download/isolated_data.rar)），每个数据集一个文件，您可以使用我们开发的这个软件（[下载软件](http://www.nlpr.ia.ac.cn/databases/download/GntView.exe)）查看它们。 [GntRead.cpp.pdf](http://www.nlpr.ia.ac.cn/databases/Download/GntRead.cpp.pdf) 中给出了从 *gnt 文件中读取图像的示例 C++ 代码。
CASIA-HWDB1.0-1.2 的完整数据集可以在这里 [下载](http://www.nlpr.ia.ac.cn/databases/handwriting/Download.html)。

### CASIA-HWDB2.0-2.2

离线文本数据库由独立字符数据集的同一作者制作。 每个人写五页给定的文本。 一位作者（编号 371）和四页因数据丢失而丢失。 每个页面都存储在以作者索引和页码命名的 *.dgrl 文件中。 除了灰度图像，数据文件还包括文本行分割的基本事实和字符类标签（GB 代码）。 数据集的统计数据和 *.dgrl 文件的格式分别如表 3 和表 4 所示。

表 3 离线手写文本数据集统计

| Dataset | #writers | #pages | #lines | #character/#class | #out-of-class sample |
|---------|----------|--------|--------|-------------------|----------------------|
| HWDB2.0 |   419    | 2,092  | 20,495 |   538,868/1,222   |        1,106         |
| HWDB2.1 |   300    | 1,500  | 17,292 |   429,553/2,310   |         172          |
| HWDB2.2 |   300    | 1,499  | 14,443 |   380,993/1,331   |         581          |
|  Total  |  1,019   | 5,091  | 52,230 |  1,349,414/2,703  |        1,859         |

类外样本是 7,356 个类（HWDB1.0-1.2 中的所有类）中的样本。

DGRL (*.dgrl) 文件存储一页文档图像。 

图像消除了背景（编码为 255），前景（文本笔画）以灰度级 0-254 编码，每个像素一个字节。 每页存储为一系列行。 每行都有一个标题，表示字符数、字符代码序列 (GBK)、左上角位置、行高和宽度，然后是位图块（高度*宽度字节）。

在将线条拼接成页面图像时，需要注意的是不同线条之间可能存在平面重叠，因为不同线条的文字笔画在纵轴上可能会重叠。 因此，为了恢复页面图像，需要合并不同行的前景像素。

表 4. 离线文本数据文件格式 (*.dgrl)

|             Item             |             Type             |            Length            |                Instance                |
|------------------------------|------------------------------|------------------------------|----------------------------------------|
|         File Header          |         File Header          |         File Header          |              File Header               |
|        Size of Header        |             int              |              4B              |  Number of bytes: 36+strlen(illustr)   |
|         Format code          |        ASCII (char*)         |              8B              |                 "DGRL"                 |
|         Illustration         |             Text             |          Arbitrary           |              "#......\0"               |
|          Code type           |        ASCII (char*)         |             20B              |          "ASCII", "GB", etc.           |
|         Code length          |            Short             |              2B              |             1, 2, 4, etc.              |
|        Bits per pixel        |            Short             |              2B              | Typically 1(B/W image), 8 (Gray image) |
| Image Records (concatenated) | Image Records (concatenated) | Image Records (concatenated) |      Image Records (concatenated)      |
|         Image height         |             int              |              4B              |   Height (pixels) of document image    |
|         Image width          |             int              |              4B              |    Width (pixels) of document image    |
|         Line number          |             int              |              4B              |      Number of lines in the image      |
| Line Records (concatenated)  | Line Records (concatenated)  | Line Records (concatenated)  |      Line Records (concatenated)       |
|         Char number          |             int              |              4B              |     Number of characters in a line     |
|         Label (code)         |          Code type           |   Code length* Char number   |   Each byte is 0xff(-1) for garbage    |
|     Top-left coordinates     |             int              |           4B + 4B            |         (top, left) of a line          |
|          Height (H)          |             int              |              4B              |       Height (pixels) of a line        |
|          Width (W)           |             int              |              4B              |        Width (pixels) of a line        |
|            Bitmap            |             BYTE             |   H*( (W + 7 ) / 8) or H*W   |          Binary or gray image          |

使用我们开发的这个软件（[下载软件](http://www.nlpr.ia.ac.cn/databases/Download/DGRLView.exe)）可以查看 DRGL 年龄图像。 [DGRLRead.cpp.pdf](http://www.nlpr.ia.ac.cn/databases/Download/DGRLRead.cpp.pdf) 中给出了从 *dgrl 文件中读取图像的示例 C++ 代码。
CASIA-OLHWDB2.0-2.2的文本行数据（文本行注释的页面图像）可以在[这里](http://www.nlpr.ia.ac.cn/databases/handwriting/Download.html)下载。

## Ground-Truthing 文本行和字符工具 (GTLC)

GTLC是一款实用的无约束离线手写中文文档标注工具。 与之前大多数对齐单词边界的工作不同，我们的目标是在不分词的情况下对齐文本行中的字符，因为中文文本在单词之间没有额外的空格。 我们已经验证了该工具的有效性，并将其应用于对 HIT-HW 数据库中的文档图像进行注释。

### 标注工具（GTLC）的使用方法

* 1) 下载[GTLC.zip](http://www.nlpr.ia.ac.cn/databases/download/GTLC.zip)文件，解压到你的电脑上；

    GTLC 包括一个可执行文件 (GTLC.exe) 和一个字典文件 (char-dic.csp)。 字典文件必须存放在子目录“classifier”中。 （如果 GTLC.exe 存储为：D:\GTLC.exe，则 char-dic.csp 必须存储为：D:\classfier\char-dic.csp）。 几个示例文档图像及其真实文件包含在 GTLC.zip 的子目录“img”中。

* 2）准备Ground-truth文件（*.txt）；
    在 Ground-truth 文件中，每一行字符（以 ENTER 分隔符结尾）对应于文档图像中的一行文本。 示例如图 1 所示。

(a) 文档图像文件
![kbmK80](https://oss.images.shujudaka.com/uPic/kbmK80.jpg)

(b) 真值文件（文本）

![SB3mGx](https://oss.images.shujudaka.com/uPic/SB3mGx.jpg)

文档图像和真实文件应具有相同的标题（但扩展名不同），例如 gtlc_test.bmp 和 gtlc_test.txt。

* 3) 打开要标注的输入文档图像文件（*.bmp）；

    GTLC V1.0只能处理二值（二进制，1位）和8位灰度位图图像文件。

* 4）提取字符（文档图像二值化）；

    双层图像不需要此步骤；
    对于灰度图像，通过单击菜单文本提取或按 Ctrl+E 按钮将其二值化。
    
    ![aGRoPt](https://oss.images.shujudaka.com/uPic/aGRoPt.jpg)
    
* 5) 分割文本行；

    通过单击菜单文本行分割或按下按钮 Ctrl+G 来分割文本行。
    
    ![mtmCx8](https://oss.images.shujudaka.com/uPic/mtmCx8.jpg)
    
    文本行分割后，连通分量（CC）将按行链接成文本行。 标记。 错误分割的 CC 可以手动更正。 例如，图 4(a) 显示了一些被错误分割到其他文本行中的 CC 图像。 要更正，请绘制一个包含要更正的 CC 的框（Ctrl + 鼠标左键）。 然后，单击用于合并 CC 的行区域（图 4（b）中的合并行）。
    
    (a) 选择错误分割的 CC
    ![7iLI0v](https://oss.images.shujudaka.com/uPic/7iLI0v.jpg)
    
    (b) 更正后的文本行
    
    ![bmAXWz](https://oss.images.shujudaka.com/uPic/bmAXWz.jpg)
    
* 6) 对齐字符；

    文本行分割后，通过单击菜单字符对齐或按下按钮 Ctrl+A（图 5），每个文本行中的字符被分割并与真实值对齐。
    
    图 5. 对齐字符。
    ![Pi8BfC](https://oss.images.shujudaka.com/uPic/Pi8BfC.jpg)
    
    错误分割或错误对齐的字符可以手动正确。 校正时，画一个方框（图6（b）中的红色方框）来包围一个字符对应的CC，然后自动调整方框字符及其相邻字符。 图 6 显示了一个例子。
    
    (a) 对齐错误示例
    
    ![0qIs6k](https://oss.images.shujudaka.com/uPic/0qIs6k.jpg)
    
    (b) 画一个黑框来包含 CC
    
    ![kwgzVn](https://oss.images.shujudaka.com/uPic/kwgzVn.jpg)
    
    (c) 校正对齐
    
    ![2Lq01o](https://oss.images.shujudaka.com/uPic/2Lq01o.jpg)
    
    如果自动对齐后有些字符被触摸（欠分割），可以手动拆分它们。 为此，画一条线（图 7（b）中的黑线）来切割要拆分的 CC（按下 Shift + 鼠标左键画线）。
    
    (a) 触摸字符的例子
    
    ![8MMyGm](https://oss.images.shujudaka.com/uPic/8MMyGm.jpg)
    
    (b) 画一条线来切割接触的 CC
    
    ![D4P7Wh](https://oss.images.shujudaka.com/uPic/D4P7Wh.jpg)
    
    (c) 修正后的触摸字符
    
    ![2iSX3z](https://oss.images.shujudaka.com/uPic/2iSX3z.jpg)

## 离线触摸(字与字有重叠,碰触)字符数据集

![fEFUof](https://oss.images.shujudaka.com/uPic/fEFUof.jpg)

### 概述

为了评估触摸字符分割算法，我们提出了一个从中文手写数据库 CASIA-HWDB 收集的触摸字符数据库，称为 [CASIA-HWDB-T](http://www.nlpr.ia.ac.cn/databases/handwriting/Offline_database.html#app)。 所有触摸字符（或字符串）都用字符类、触摸点的位置以及字符串高度（LH）和平均笔划宽度（SW）等辅助值进行注释。

根据不同的语言类型，我们将触摸字符串分为四个子集：2,788 个全数字字符串（HWDB-T-allDigits），328 个全字母字符串（HWDB-T-allLetters），50,157 个全中文字符串（HWDB-T -allChinese）和3,196个混合字符（HWDB-T-other）。

根据字符和触摸点的数量，我们将数据集分为三个子集：48,536 个单触摸对 (HWDB-ST-P)，6,115 个超过两个字符的单触摸字符串 (HWDB-ST-M)，以及 1,818 个多点触摸对 (HWDB-MT)。 有关数据集的更多详细信息，请参阅下面列出的论文。

### 下载

[HWDB-T-allDigits](http://www.nlpr.ia.ac.cn/databases/download/tchStrData/all_Tch_allDigit.zip)(3.73MB)
[HWDB-T-allLetters](http://www.nlpr.ia.ac.cn/databases/download/tchStrData/all_Tch_allLetter.zip)(0.54MB)
[HWDB-T-allChinese](http://www.nlpr.ia.ac.cn/databases/download/tchStrData/all_Tch_allHanzi.zip)(207MB)
[HWDB-T-other](http://www.nlpr.ia.ac.cn/databases/download/tchStrData/all_Tch_other.zip)(8.6MB)

[HWDB-ST-P](http://www.nlpr.ia.ac.cn/databases/download/tchStrData/all_SngTch2.zip)(178MB)
[HWDB-ST-M](http://www.nlpr.ia.ac.cn/databases/download/tchStrData/all_SngTch3Mr.zip)(34.6MB)
[HWDB-MT](http://www.nlpr.ia.ac.cn/databases/download/tchStrData/all_MultTch2.zip)(7.5MB)

所有数据集都以 tcs 文件格式存储，如表 1 所示。tcs 文件的格式也在 [FileFormat-tcs.pdf](http://www.nlpr.ia.ac.cn/databases/download/tchStrData/FileFormat_tcs.pdf) 中进行了描述。

表 1 离线真实感触字符串图像（*.tcs）文件格式

|                               Item                                |                Type                 |          Length (B: Byte)           |                                                    Instance                                                     |
|-------------------------------------------------------------------|-------------------------------------|-------------------------------------|-----------------------------------------------------------------------------------------------------------------|
|                            File Header                            |             File Header             |             File Header             |                                                   File Header                                                   |
|                          Size of Header                           |              Long int               |                 4B                  |                                       Number of bytes: 36+strlen(illustr)                                       |
|                            Format code                            |            ASCII (char*)            |                 8B                  |                                                      “tcs”                                                      |
|                           Illustration                            |                Text                 |              Arbitrary              |                                                 “#CASIA-HWDB-T”                                                 |
|                             Code type                             |            ASCII (char*)            |                 20B                 |                                                “ASCII” or “GB”.                                                 |
|                         Code Length (CL)                          |              Short int              |                 2B                  |                                               1 (ASCII), 2 (GB).                                                |
|                          Bits per pixel                           |              Short int              |                 2B                  |                                                 8 (Gray image)                                                  |
|                String Image Records (concatenated)                | String Image Records (concatenated) | String Image Records (concatenated) |                                       String Image Records (concatenated)                                       |
|                         Stroke Width (SW)                         |              Short int              |                 2B                  |                                                                                                                 |
|                         Line Height (LH)                          |              Short int              |                 2B                  |                                                                                                                 |
|                  Number of Touching Points (NTP)                  |              Short int              |                 2B                  |                                                   1, 2, 3, …                                                    |
| Position sequence of top and bottom terminal of touching point(s) |              Short int              |         2 * (2B + 2B) * NTP         | For each touching point, first top terminal, then bottom terminal; For each terminal, first  row,  then column. |
|                    *Number of Characters (NC)                     |              Short int              |                 2B                  |                                                   2, 3, 4, …                                                    |
|                      Character labels (code)                      |              Code type              |               NC * CL               |                                                                                                                 |
|                        Height of image (H)                        |              Short int              |                 2B                  |                                                                                                                 |
|                        Width of image (W)                         |              Short int              |                 2B                  |                                                                                                                 |
|                              bitmap                               |                Byte                 |                H * W                |                                                   Gray image                                                    |

*对于单点触摸字符串图像，NC = (NTP + 1)； 对于多点触摸字符对图像，NC <= NTP 且 NC = 2。

这是三个示例文件（[下载文件](http://www.nlpr.ia.ac.cn/databases/download/tchStrData/tcs_3eg.zip)），每个文件都包含所有数字、所有字母和所有中文。 您可以使用我们开发的此软件（[下载软件](http://www.nlpr.ia.ac.cn/databases/download/tchStrData/TcsDisp.exe)）查看它们。

出版物：
Liang Xu、Fei Yin、Qiu-Feng Wang、Cheng-Lin Liu，“[用于评估分割算法的中国手写感人字符数据库](http://www.nlpr.ia.ac.cn/databases/download/tchStrData/TchStrData-ICHFR2012.pdf)”，第 13 届国际手写识别前沿会议论文集（ICFHR），意大利巴里，2012 年 .


## 数据下载

本页面提供了用于评估孤立手写汉字识别的标准数据集，包括使用现有特征提取算法生成的特征数据和原始字符样本数据。 这里也提供了ICDAR2013竞赛的测试数据集（包括文本数据）。

自2020年2月起，本页面可下载所有离线人物图片和文字页面（以文字行级别标注）。

线上数据全量数据即将上线。

### 下载特征数据

为了能够对标准特征数据进行机器学习和分类算法的评估，我们提供了离线手写数据集HWDB1.0和HWDB1.1、在线手写数据集OLHWDB1.0和OLHWDB1.1的特征数据。 样本属于 GB2312-80 一级字集中的 3,755 类汉字。 拟将数据集HWDB1.1和OLHWDB1.1（300名作者）用于标准类别集汉字识别的初步实验。 可以将数据集HWDB1.0 和OLHWDB1.0 (420 writers) 添加到HWDB1.1 和OLHWDB1.1 以扩大训练集大小。

特征提取方法在下面的参考文献中指定，那里报告的结果可用于公平比较：

C.-L。 Liu, F. Yin, D.-H. 王，Q.-F。 王，在线和离线手写汉字识别：新数据库基准测试，模式识别，46(1): 155-162, 2013.

对于离线字符，提取的特征是归一化协同梯度特征（NCGF）的8方向直方图，结合伪二维归一化方法线密度投影插值。 生成的特征是 512D。

对于在线字符，提取的特征是原始轨迹方向的8方向直方图结合伪二维双矩归一化。 生成的特征是 512D。

> NCGF（Normalization-Cooperated Gradient Feature）是一种特征提取方法，用于离线字符识别。它结合了8方向直方图和伪二维归一化方法线密度投影插值，生成了一个512维的特征向量。
> NCGF首先计算字符图像的梯度信息，然后将梯度方向分成8个方向（水平、垂直和对角线方向）。然后，对每个方向的梯度进行归一化处理，以消除图像的亮度和对比度差异。这样做是为了使特征具有更好的鲁棒性和不变性。
> 接下来，NCGF利用伪二维归一化方法进行线密度投影插值。该方法将字符图像分割为多个区域，并计算每个区域中线条的密度。通过将线条密度投影到一个虚拟的二维平面上，并进行插值处理，NCGF能够捕捉到字符的形状和结构信息。
> 最后，NCGF将每个方向的梯度直方图和线密度插值结果连接起来，形成一个512维的特征向量。这个特征向量可以用于离线字符识别任务，例如手写数字或字母的识别。
> 总的来说，NCGF是通过梯度方向归一化和线密度投影插值相结合的方法，提取字符图像的特征，以便于后续的离线字符识别任务。

> NCGF的操作是一种特征提取方法，它将原始的字符图像转换为一个512维的特征向量。这个特征向量捕捉了字符的形状和结构信息，但丢失了原始图像的像素级细节。
> 由于NCGF是通过将图像转换为特征向量的方式进行操作的，所以一般情况下是无法通过逆运算得到完全准确的原始图像结果的。特征向量是通过对图像进行梯度计算、归一化和线密度插值等操作得到的，这些操作会丢失一些细节信息。
> 逆运算通常用于将特征向量还原为原始数据的情况，例如在某些压缩算法中。但对于NCGF来说，它是一种特征提取方法，旨在将图像转换为高维特征表示以供后续处理使用，而不是将特征向量还原为原始图像。
> 因此，一般来说，NCGF操作的数据无法通过逆运算得到原始结果。如果需要还原原始图像，通常需要使用其他方法或技术，如逆变换或逆向重建方法。
每个数据集的特征数据被划分为两个子集，分别用于训练和测试。 作者数量和文件样本如下表所示。

|  Dataset  | #class | Dimension | #writer | #writer |  #sample  | #sample |
|-----------|--------|-----------|---------|---------|-----------|---------|
|           |        |           |  Train  |  Test   |   Train   |  Test   |
|  HWDB1.0  | 3,740  |    512    |   336   |   84    | 1,246,991 | 309,684 |
|  HWDB1.1  | 3,755  |    512    |   240   |   60    |  897,758  | 223,991 |
| OLHWDB1.0 | 3,740  |    512    |   336   |   84    | 1,256,009 | 314,042 |
| OLHWDB1.1 | 3,755  |    512    |   240   |   60    |  898,573  | 224,559 |


特征数据文件的格式在 [fileFormat-mpf.pdf](http://www.nlpr.ia.ac.cn/databases/download/feature_data/FileFormat-mpf.pdf) 中描述。 

简而言之，每个文件都有一个标头，标头大小作为文件中的第一个 4 字节整数给出。 标题中的最后两个整数给出了文件中的样本数和特征维度。 header之后是所有样本的记录，每个样本包括一个2字节的标签（GB码）和特征向量，每个维度在一个unsigned char字节中。

为了能够进行特定作者的数据分析，将每个作者的特征数据存储在以作者索引命名的文件中。 数据集的训练或测试数据文件打包在 ZIP 存档中。 请点击以下链接下载。

[HWDB1.0trn](http://www.nlpr.ia.ac.cn/databases/download/feature_data/HWDB1.0trn.zip)(397MB) 
[HWDB1.0tst](http://www.nlpr.ia.ac.cn/databases/download/feature_data/HWDB1.0tst.zip)(98MB) 
[HWDB1.1trn](http://www.nlpr.ia.ac.cn/databases/download/feature_data/HWDB1.1trn.zip)(287MB) 
[HWDB1.1tst](http://www.nlpr.ia.ac.cn/databases/download/feature_data/HWDB1.1tst.zip)(71MB) 

[OLHWDB1.0trn](http://www.nlpr.ia.ac.cn/databases/download/feature_data/OLHWDB1.0trn.zip)(384MB) 
[OLHWDB1.0tst](http://www.nlpr.ia.ac.cn/databases/download/feature_data/OLHWDB1.0tst.zip) (96MB) 
[OLHWDB1.1trn](http://www.nlpr.ia.ac.cn/databases/download/feature_data/OLHWDB1.1trn.zip) (274MB) 
[OLHWDB1.1tst](http://www.nlpr.ia.ac.cn/databases/download/feature_data/OLHWDB1.1tst.zip) (68MB)

### 下载字符样本数据

我们提供孤立字符数据集HWDB1.0-1.2（离线）和OLHWDB1.0-1.2（在线），用于研究孤立字符识别和文本行识别分类器的预训练。 每个数据集都被划分为一个标准训练集和一个由不相交的作者组成的测试集。 下载链接如下。 离线字符（*.gnt）和在线字符（*.pot）的格式说明分别在[离线数据库](http://www.nlpr.ia.ac.cn/databases/handwriting/Offline_database.html)和[在线数据库](http://www.nlpr.ia.ac.cn/databases/handwriting/Online_database.html)页面中找到。

HWDB1.0-1.2 的完整数据集可以在下面下载。

Gnt1.0Train [part1](http://www.nlpr.ia.ac.cn/databases/Download/Offline/CharData/Gnt1.0TrainPart1.zip) (962MB), [part2](http://www.nlpr.ia.ac.cn/databases/Download/Offline/CharData/Gnt1.0TrainPart2.zip) (973MB), [part3](http://www.nlpr.ia.ac.cn/databases/Download/Offline/CharData/Gnt1.0TrainPart3.zip) (983MB)  
[Gnt1.0Test](http://www.nlpr.ia.ac.cn/databases/Download/Offline/CharData/Gnt1.0Test.zip) (722MB)  

Gnt1.1Train [part1](http://www.nlpr.ia.ac.cn/databases/Download/Offline/CharData/Gnt1.1TrainPart1.zip) (897MB), [part2](http://www.nlpr.ia.ac.cn/databases/Download/Offline/CharData/Gnt1.1TrainPart2.zip) (943MB)  
[Gnt1.1Test](http://www.nlpr.ia.ac.cn/databases/Download/Offline/CharData/Gnt1.1Test.zip) (468MB)  

Gnt1.2Train [part1](http://www.nlpr.ia.ac.cn/databases/Download/Offline/CharData/Gnt1.2TrainPart1.zip) (998MB), [part2](http://www.nlpr.ia.ac.cn/databases/Download/Offline/CharData/Gnt1.2TrainPart2.zip) (987MB)  
[Gnt1.2Test](http://www.nlpr.ia.ac.cn/databases/Download/Offline/CharData/Gnt1.2Test.zip) (510MB)

OLHWDB1.0-1.2 的完整数据集可在下方下载。

[Pot1.0Train](http://www.nlpr.ia.ac.cn/databases/Download/Online/CharData/Pot1.0Train.zip) (273MB)  
[Pot1.0Test](http://www.nlpr.ia.ac.cn/databases/Download/Online/CharData/Pot1.0Test.zip) (68MB)  
[Pot1.1Train](http://www.nlpr.ia.ac.cn/databases/Download/Online/CharData/Pot1.1Train.zip) (189MB)  
[Pot1.1Test](http://www.nlpr.ia.ac.cn/databases/Download/Online/CharData/Pot1.1Test.zip) (47MB)  
[Pot1.2Train](http://www.nlpr.ia.ac.cn/databases/Download/Online/CharData/Pot1.2Train.zip) (196MB)  
[Pot1.2Test](http://www.nlpr.ia.ac.cn/databases/Download/Online/CharData/Pot1.2Test.zip) (50MB)

### 下载文本行（页面）数据

我们提供了HWDB2.0-2.2的离线文本行数据（存储在DGRL文件中，每页包含多行）和OLHWDB2.0-2.2的在线文本行数据（存储在WPTT文件中）用于文本行识别的研究。 每个数据集的文本行统计信息可以在离线数据库和在线数据库的页面中找到。 每个数据集都被分成多组页面（文本行）用于训练和测试。

HWDB2.0-2.2 的完整数据集可以在下面下载。

[HWDB2.0Train](http://www.nlpr.ia.ac.cn/databases/Download/Offline/TextlineData/HWDB2.0Train.zip) (709MB)  
[HWDB2.0Test](http://www.nlpr.ia.ac.cn/databases/Download/Offline/TextlineData/HWDB2.0Test.zip) (175MB)  
[HWDB2.1Train](http://www.nlpr.ia.ac.cn/databases/Download/Offline/TextlineData/HWDB2.1Train.zip) (540MB)  
[HWDB2.1Test](http://www.nlpr.ia.ac.cn/databases/Download/Offline/TextlineData/HWDB2.1Test.zip) (136MB)  
[HWDB2.2Train](http://www.nlpr.ia.ac.cn/databases/Download/Offline/TextlineData/HWDB2.2Train.zip) (515MB)  
[HWDB2.2Test](http://www.nlpr.ia.ac.cn/databases/Download/Offline/TextlineData/HWDB2.2Test.zip) (128MB)

OLHWDB2.0-2.2 的完整数据集可以在下面下载。

[WPTT2.0-Train](http://www.nlpr.ia.ac.cn/databases/Download/Online/WPTTData/WPTT2.0-Train.zip) (62MB)  
[WPTT2.0-Test](http://www.nlpr.ia.ac.cn/databases/Download/Online/WPTTData/WPTT2.0-Test.zip) (15MB)  
[WPTT2.1-Train](http://www.nlpr.ia.ac.cn/databases/Download/Online/WPTTData/WPTT2.1-Train.zip) (50MB)  
[WPTT2.1-Test](http://www.nlpr.ia.ac.cn/databases/Download/Online/WPTTData/WPTT2.1-Test.zip) (12MB)  
[WPTT2.2-Train](http://www.nlpr.ia.ac.cn/databases/Download/Online/WPTTData/WPTT2.2-Train.zip) (44MB)  
[WPTT2.2-Test](http://www.nlpr.ia.ac.cn/databases/Download/Online/WPTTData/WPTT2.2-Test.zip) (10MB) 

### 下载竞赛测试数据

基于CASIA-HWDB和CASIA-OLHWDB数据库，我们分别在2010年、2011年和2013年组织了中文手写识别比赛，现将比赛测试数据开放研究。 有 60 位作者生成的四个数据集：离线字符数据、在线字符数据、离线文本数据、在线文本数据。 数据格式规范可以在[离线数据库](http://www.nlpr.ia.ac.cn/databases/handwriting/Offline_database.html)和[在线数据库](http://www.nlpr.ia.ac.cn/databases/handwriting/Online_database.html)页面找到。

[Offline Character Data](http://www.nlpr.ia.ac.cn/databases/Download/competition/competition-gnt.zip) (448MB)  
[Online Character Data](http://www.nlpr.ia.ac.cn/databases/Download/competition/competition_POT.zip) (45MB)  
[Offline Text Data](http://www.nlpr.ia.ac.cn/databases/Download/Offline/TextlineData/Competition13Line.zip) (140MB) in DGRL format  
[Online Text Data](http://www.nlpr.ia.ac.cn/databases/Download/Online/WPTTData/Competition13wptt.zip) (12MB)

## 使用条件和申请表

由中国科学院建设的在线和离线中文手写数据库，根据协议免费发布，供学术研究使用。

从 2020 年起，下载学术研究数据集不再需要申请表。 所有数据都可以在数据下载页面下载。

数据库的商业使用是收费的。 如需可能的商业使用许可，请联系 Cheng-Lin Liu。 商业用途的数据库扩大到包含1220位作者的数据，并对所有文本页面进行了详细的注释。

## 学术使用条件

本协议项下数据库中的所有样本只能由指定申请人的团队使用，并且只能用于研究目的。 任何样品都不能用于任何商业目的。
中国科学院自动化研究所保留数据库中所有样本数据的版权。
在数据库中发表的研究结果应该得到适当的承认。 推荐参考如下：
C.-L。 Liu, F. Yin, D.-H. 王，Q.-F。 Wang, CASIA 在线和离线中文手写数据库, Proc. 第 11 届文档分析与识别国际会议 (ICDAR)，中国北京，2011 年，pp.37-41。